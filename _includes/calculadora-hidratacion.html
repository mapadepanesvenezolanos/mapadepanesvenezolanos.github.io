<style>
  .container {
    margin: 20px auto;
    border: 1px;
    font-size: 17px;
  }

  .row {
    flex-wrap: unset !important;
  }

  .col-form-label {
    padding-top: 0px !important;
    padding-bottom: 0px !important;
  }

  h1 {
    text-align: left;
    margin-bottom: 30px;
  }

  .percent {
    width: 100%;
    text-align: right;
  }

  .weight {
    border: none;
    background-color: transparent;
    width: 100%;
    text-align: right;
    pointer-events: none;
  }

  .topingredient {
    margin-bottom: 10px;
  }

  .ingredient {
    margin-bottom: 10px;
  }

  .mb-20 {
    margin-bottom: 20px;
  }

  .ingredients {
    width: 100%;
    text-align: left;
    padding-left: 5;
    margin-right: 50px;
  }

  .no-pl {
    padding-left: 0px !important;
    margin-left: 0px !important;
  }

  @media print {
    .non-printable {
      display: none;
    }
  }
</style>

<div class="container">
  <h1>Calculadora de hidratación — fórmula panadera</h1>
  <p class="lead">Introduce los ingredientes (peso en gramos) y selecciona el tipo para que la calculadora estime la hidratación total de la fórmula.</p>

  <table id="ingredients-table">
    <thead>
      <tr>
        <th style="width:36%">Ingrediente</th>
        <th style="width:18%">Tipo</th>
        <th style="width:18%">Peso (g)</th>
        <th style="width:18%">% agua (por defecto)</th>
        <th style="width:10%">Acc.</th>
      </tr>
    </thead>
    <tbody>
      <!-- filas dinámicas -->
    </tbody>
  </table>

  <div class="actions">
    <button id="add-row">➕ Añadir ingrediente</button>
    <button id="calc" style="margin-left:6px">Calcular hidratación</button>
    <button id="reset" class="secondary" style="margin-left:auto">Reset</button>
  </div>

  <div class="result" id="result">
    <div class="small">Harina total: <strong id="total-flour">0</strong> g</div>
    <div class="small">Agua equivalente total: <strong id="total-water">0</strong> g</div>
    <div class="small">Hidratación: <strong id="hydration">0%</strong></div>
    <div class="note">Consejo: marca un ingrediente como <em>Harina</em> para que sume al total de harinas. Los tipos <em>Líquido</em> y <em>Enriquecedor</em> usan el % de agua para calcular su aporte.</div>
  </div>

</div>
<script>
(function(){
  const tableBody = document.querySelector('#ingredients-table tbody');
  const addBtn = document.getElementById('add-row');
  const calcBtn = document.getElementById('calc');
  const resetBtn = document.getElementById('reset');
  const totalFlourEl = document.getElementById('total-flour');
  const totalWaterEl = document.getElementById('total-water');
  const hydrationEl = document.getElementById('hydration');

  // valores por defecto para ingredientes comunes (porcentaje de agua aproximado)
  const defaults = {
    'Harina panadera': {type:'Harina', waterPct:0},
    'Agua': {type:'Líquido', waterPct:100},
    'Huevos ligeramente batidos': {type:'Enriquecedor', waterPct:75},
    'Mantequilla sin sal': {type:'Enriquecedor', waterPct:15},
    'Leche condensada': {type:'Enriquecedor', waterPct:27},
    'Leche en polvo': {type:'Enriquecedor', waterPct:5},
    'Azúcar': {type:'Enriquecedor', waterPct:0},
    'Sal': {type:'Enriquecedor', waterPct:0},
    'Levadura': {type:'Enriquecedor', waterPct:0},
    'Esencia de vainilla': {type:'Enriquecedor', waterPct:60}
  };

  function createRow(name = '', type='Harina', weight=0, pct=0){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input class="ing-name" type="text" placeholder="Ej: Harina panadera" value="${name}" list="ing-list" /></td>
      <td>
        <select class="ing-type">
          <option value="Harina">Harina</option>
          <option value="Líquido">Líquido</option>
          <option value="Enriquecedor">Enriquecedor</option>
          <option value="Otro">Otro</option>
        </select>
      </td>
      <td><input class="ing-weight" type="number" min="0" step="0.1" value="${weight}" /></td>
      <td><input class="ing-pct" type="number" min="0" max="100" step="0.1" value="${pct}" /></td>
      <td class="right"><button class="remove">✖</button></td>
    `;

    // eventos
    const nameInput = tr.querySelector('.ing-name');
    const typeSelect = tr.querySelector('.ing-type');
    const weightInput = tr.querySelector('.ing-weight');
    const pctInput = tr.querySelector('.ing-pct');
    const removeBtn = tr.querySelector('.remove');

    // set initial type
    typeSelect.value = type;

    // when ingredient name changes, try to apply defaults
    nameInput.addEventListener('change', ()=>{
      const v = nameInput.value.trim();
      if(defaults[v]){
        typeSelect.value = defaults[v].type;
        pctInput.value = defaults[v].waterPct;
      }
    });

    // quick change when type is changed: if type==Líquido set pct 100 unless overridden
    typeSelect.addEventListener('change', ()=>{
      if(typeSelect.value === 'Líquido' && (!pctInput.value || pctInput.value==0)) pctInput.value = 100;
      if(typeSelect.value === 'Harina') pctInput.value = 0;
    });

    removeBtn.addEventListener('click', ()=>{ tr.remove(); updateResult(); });

    // recalc on input
    [nameInput, typeSelect, weightInput, pctInput].forEach(el=>el.addEventListener('input', updateResult));

    tableBody.appendChild(tr);
    return tr;
  }

  function addSampleRows(){
    createRow('Harina panadera','Harina',328,0);
    createRow('Agua','Líquido',115,100);
    createRow('Levadura instantánea','Enriquecedor',4.9,0);
    createRow('Sal','Enriquecedor',3.3,0);
    createRow('Huevos ligeramente batidos','Enriquecedor',65.5,75);
    createRow('Mantequilla sin sal','Enriquecedor',49,15);
    createRow('Azúcar','Enriquecedor',66,0);
    createRow('Leche condensada','Enriquecedor',20,27);
  }

  function updateResult(){
    const rows = Array.from(tableBody.querySelectorAll('tr'));
    let totalFlour = 0;
    let totalWater = 0;

    rows.forEach(r=>{
      const type = r.querySelector('.ing-type').value;
      const weight = parseFloat(r.querySelector('.ing-weight').value) || 0;
      const pct = parseFloat(r.querySelector('.ing-pct').value) || 0;

      if(type === 'Harina') totalFlour += weight;
      // agua equivalente = peso * pct/100
      totalWater += weight * (pct/100);
    });

    const hydration = totalFlour > 0 ? (totalWater / totalFlour) * 100 : 0;

    totalFlourEl.textContent = round(totalFlour,1) + ' g';
    totalWaterEl.textContent = round(totalWater,1) + ' g';
    hydrationEl.textContent = round(hydration,2) + ' %';
  }

  function round(n,dec=2){
    const p = Math.pow(10,dec);
    return Math.round(n*p)/p;
  }

  addBtn.addEventListener('click', ()=>{ createRow(); });
  calcBtn.addEventListener('click', updateResult);
  resetBtn.addEventListener('click', ()=>{ tableBody.innerHTML=''; updateResult(); addSampleRows(); });

  // datalist for quick ingredient names
  const dl = document.createElement('datalist'); dl.id='ing-list';
  Object.keys(defaults).forEach(k=>{ const o = document.createElement('option'); o.value=k; dl.appendChild(o);} );
  document.body.appendChild(dl);

  // iniciar con ejemplos (inspirados en tu fórmula)
  addSampleRows();
  updateResult();
})();
</script>
